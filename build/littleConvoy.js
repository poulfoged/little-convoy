/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../node_modules/almond/almond",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("lib/Promise",["require","exports"],function(e,t){(function(e){function t(e){return!!e&&typeof e.then=="function"}function n(){var e=new Error("Canceled");return e.name="Canceled",e}var r;(function(){typeof process=="object"&&typeof process.nextTick=="function"?r=function(e){process.nextTick(e)}:typeof setImmediate=="function"?r=function(e){setImmediate(e)}:typeof MessageChannel!="undefined"?r=function(e){var t=new MessageChannel;t.port1.onmessage=function(){t.port1.onmessage=null,t=null,e()},t.port2.postMessage(0)}:typeof window=="object"&&typeof window.postMessage=="function"&&typeof window.addEventListener=="function"?r=function(e){window.addEventListener("message",function t(n){window.removeEventListener("message",t,!1),e()},!1),window.postMessage("triger of function call","*")}:typeof window=="object"&&typeof window.postMessage!="undefined"&&typeof window.attachEvent!="undefined"?r=function(e){var t=function(n){window.detachEvent("onmessage",t),e()};window.attachEvent("onmessage",t),window.postMessage("triger of function call","*")}:typeof setTimeout!="undefined"?r=function(e){setTimeout(e,0)}:r=function(e){throw new Error("queueTaskToEventLoop method not implemented")}})();var i=function(){function e(){this.__stat=e._STAT_EMPTY,this.__callbacks=[]}return e.prototype.then=function(t,n,i){var s=new e;s.__parentPromise=this;var o={s:t,e:n,p:i,prom:s};if(this.__isUnfulfilled())this.__callbacks.push(o);else{var u=this;r(function(){u.__handleCallbacks([o])})}return s},e.prototype.progressed=function(e){return this.then(null,null,e)},e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){return this.then(e,e)},e.prototype.cancel=function(){var t;if(this.__stat===e._STAT_EMPTY)var t=this.__parentPromise;else if(this.__stat===e._STAT_WAIT)var t=this.__val;t&&typeof t.cancel=="function"&&t.cancel(),this.__stat!==e._STAT_WAIT&&this._putError(n())},e.prototype.__callbackAll=function(){this.__handleCallbacks(this.__callbacks)},e.prototype.__handleCallbacks=function(e){var t=[],n=e.slice(0).reverse();while(n.length>0){var r=n.pop(),i=this.__callCallbackFunction(r),s;if(s=r.prom)i.prom=s,t.push(i)}while(t.length>0){var i=t.pop();i.errorOccur?i.prom._putError(i.value):i.prom._putValOrProm(i.value)}},e.prototype.__callCallbackFunction=function(t){var n,r=!1;try{var i=t[this.__callbackTypeName];typeof i!="function"?(n=this.__val,r=this.__stat===e._STAT_ERROR):n=i.call(null,this.__val)}catch(s){r=!0,n=s}return{errorOccur:r,value:n,prom:void 0}},e.prototype.__callProgressCallbacks=function(e){var t=this.__callbacks.slice(0).reverse();while(t.length>0){var n=t.pop(),r=n.p;if(r)try{r(e)}catch(i){}}},e.prototype.__isUnfulfilled=function(){return(this.__stat&e._BITS_UNFULFILLED_STAT)!==0},e.prototype.__setValue=function(t){this.__stat=e._STAT_FULFIL,this.__val=t,this.__callbackTypeName="s",this.__callbackAll()},e.prototype.__setError=function(t){this.__stat=e._STAT_ERROR,this.__val=t,this.__callbackTypeName="e",this.__callbackAll()},e.prototype.__waitFor=function(t){this.__stat=e._STAT_WAIT,this.__val=t;var n=this;t.then(function(t){n._putValue(t)},function(t){n._putError(t)},function(t){n.__callProgressCallbacks(t)})},e.prototype._putValOrProm=function(e){if(!this.__isUnfulfilled())return;t(e)?this.__waitFor(e):this.__setValue(e)},e.prototype._putValue=function(e){if(!this.__isUnfulfilled())return;this.__setValue(e)},e.prototype._putError=function(e){if(!this.__isUnfulfilled())return;this.__setError(e)},e.prototype._progress=function(e){if(!this.__isUnfulfilled())return;this.__callProgressCallbacks(e)},e._STAT_EMPTY=1,e._STAT_WAIT=2,e._STAT_FULFIL=4,e._STAT_ERROR=8,e._BITS_UNFULFILLED_STAT=3,e}();e.BasePromise=i;var s=function(e){function t(t,n){e.call(this),this.__onCancel=n;var r=this,i=function(e){r._putValOrProm(e)},s=function(e){r._putError(e)},o=function(e){r._progress(e)};try{t(i,s,o)}catch(u){s(u)}}return __extends(t,e),t.prototype.cancel=function(){if(typeof this.__onCancel=="function")try{this.__onCancel()}catch(t){}e.prototype.cancel.call(this)},t}(i);e.Promise=s})(t.Ten||(t.Ten={}));var n=t.Ten}),define("LittleConvoy.Client",["require","exports","lib/Promise"],function(e,t,n){(function(t){var r=function(){function t(e){this.transportName=e}return t.prototype.send=function(t,r){var i=this;return t.method=t.method?t.method:"post",t.timeout=t.timeout?t.timeout:2e4,new n.Ten.Promise(function(n,s,o){e(["LittleConvoy.Transports."+i.transportName],function(e){var s=new e.LittleConvoy.Transports[i.transportName+"Transport"];n(s.send(t,r))})})},t}();t.Client=r})(t.LittleConvoy||(t.LittleConvoy={}));var r=t.LittleConvoy}),define("LittleConvoy.Transports.HiddenFrame",["require","exports","lib/Promise"],function(e,t,n){(function(e){(function(e){var t=function(){function e(){this.progress=0,this.buffer=[]}return e}(),r=function(){function e(){}return e.prototype.send=function(e,r){var i=this,s=new t,o,u,a,f,l,c=new n.Ten.Promise(function(t,n,c){if(!JSON)throw new Error("This transport requires JSON to be available, maybe add a polyfill?");var h=function(e){return n(new Error(e))},p=i.createId();u=i.createFrame(p),i.bindRejectionHandler(s,u,h),f=i.resetTimeout(f,e,h),a=i.createHiddenForm(u.contentWindow.document,p,e,r),a.submit(),setTimeout(function(){l=i.createFrame(i.createId()),l.src="about:blank"},10),o=function(r){if(p!=r.data.callId)return;f=i.resetTimeout(f,e,function(e){return n(new Error(e))}),s.buffer.push(r.data.chunk),s.progress=r.data.progress,c(r.data.progress),r.data.progress>=100&&(console.log("full content now"),s.buffer.length==1&&s.buffer[0]==""?t():t(JSON.parse(s.buffer.join(""))))},window.addEventListener("message",o,!1)});return c.finally(function(){f&&window.clearTimeout(f),o&&window.removeEventListener("message",o),u&&u.parentElement.removeChild(u),a&&a.parentElement.removeChild(a),l&&l.parentElement.removeChild(l)}),c},e.prototype.resetTimeout=function(e,t,n){return e&&window.clearTimeout(e),window.setTimeout(function(){return n("Timeout")},t.timeout)},e.prototype.createHiddenForm=function(e,t,n,r){var i=e.createElement("form");return i.setAttribute("method",n.method),i.setAttribute("action",n.url),i.setAttribute("target","littleConvoy_"+t),this.addHiddenField(i,"_callId",t.toString()),n.delay&&this.addHiddenField(i,"_delay",n.delay.toString()),r&&this.addHiddenField(i,"_json",JSON.stringify(r)),window.document.getElementsByTagName("body")[0].appendChild(i),i},e.prototype.addHiddenField=function(e,t,n){var r=document.createElement("input");r.type="hidden",r.name=t,r.value=n,e.appendChild(r)},e.prototype.createId=function(){return(new Date).getUTCMilliseconds()},e.prototype.bindRejectionHandler=function(e,t,n){var r=function(){setTimeout(function(){!e.progress||e.progress<=0?n("Unable to load, invalid url?"):e.progress<100&&n("Only loaded partially")},100)};t.onload?t.onload=r:t.addEventListener?t.addEventListener("load",r,!1):t.attachEvent&&t.attachEvent("onload",r)},e.prototype.createFrame=function(e){var t=window.document.createElement("iframe");return t.setAttribute("style","position:absolute;top:0;left:0;width:0;height:0;visibility:hidden;"),t.setAttribute("name","littleConvoy_"+e),window.document.body.appendChild(t),t},e}();e.HiddenFrameTransport=r})(e.Transports||(e.Transports={}));var t=e.Transports})(t.LittleConvoy||(t.LittleConvoy={}));var r=t.LittleConvoy});